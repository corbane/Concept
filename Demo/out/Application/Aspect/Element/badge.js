import * as db from "../../Data/db.js";
import { Shape } from "./shape.js";
export class Badge extends Shape {
    constructor(options) {
        super(options);
        this.owner = undefined;
        this.position = { angle: 0, offset: 0 };
        // }
        // init ()
        // {
        //      super.init ()
        const { group } = this;
        const entity = db.getData(this.config.data);
        const text = new fabric.Textbox(entity.emoji || "X", {
            fontSize: this.displaySize(),
            originX: "center",
            originY: "center",
            left: group.left,
            top: group.top,
        });
        group.addWithUpdate(text);
    }
    displaySize() {
        return 20;
    }
    attach(target, pos = {}) {
        const { random, PI } = Math;
        if (!isFinite(pos.angle))
            pos.angle = random() * PI * 2;
        if (!isFinite(pos.offset))
            pos.offset = 0.1;
        this.position = Object.assign({}, pos);
        if (this.owner != undefined)
            target.group.remove(this.group);
        target.group.add(this.group);
        this.owner = target;
        this.updatePosition();
    }
    updatePosition() {
        const { position: pos, owner } = this;
        if (owner == undefined)
            return;
        const { random, PI, cos, sin } = Math;
        const rad = pos.angle || random() * PI * 2;
        const x = sin(rad);
        const y = cos(rad);
        const s = owner.displaySize() / 2;
        const offset = typeof pos.offset == "number"
            ? this.displaySize() * pos.offset
            : this.displaySize() * 0.1;
        this.setPosition(x * (s + offset), y * (s + offset));
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFkZ2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9BcHBsaWNhdGlvbi9Bc3BlY3QvRWxlbWVudC9iYWRnZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEtBQUssRUFBRSxNQUFNLGtCQUFrQixDQUFBO0FBRXRDLE9BQU8sRUFBRSxLQUFLLEVBQVUsTUFBTSxZQUFZLENBQUE7QUFJMUMsTUFBTSxPQUFPLEtBQU0sU0FBUSxLQUFLO0lBTTNCLFlBQWMsT0FBZTtRQUV4QixLQUFLLENBQUcsT0FBTyxDQUFFLENBQUE7UUFOYixVQUFLLEdBQUcsU0FBa0IsQ0FBQTtRQUUxQixhQUFRLEdBQUcsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUUsQ0FBQTtRQUszQyxJQUFJO1FBQ0osVUFBVTtRQUNWLElBQUk7UUFDSixxQkFBcUI7UUFFaEIsTUFBTSxFQUFFLEtBQUssRUFBRSxHQUFHLElBQUksQ0FBQTtRQUV0QixNQUFNLE1BQU0sR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFZLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFFLENBQUE7UUFFdkQsTUFBTSxJQUFJLEdBQUcsSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFHLE1BQU0sQ0FBQyxLQUFLLElBQUksR0FBRyxFQUFFO1lBQ2xELFFBQVEsRUFBRSxJQUFJLENBQUMsV0FBVyxFQUFHO1lBQzdCLE9BQU8sRUFBRyxRQUFRO1lBQ2xCLE9BQU8sRUFBRyxRQUFRO1lBQ2xCLElBQUksRUFBTSxLQUFLLENBQUMsSUFBSTtZQUNwQixHQUFHLEVBQU8sS0FBSyxDQUFDLEdBQUc7U0FDdkIsQ0FBQyxDQUFBO1FBRUYsS0FBSyxDQUFDLGFBQWEsQ0FBRyxJQUFJLENBQUUsQ0FBQTtJQUNqQyxDQUFDO0lBRUQsV0FBVztRQUVOLE9BQU8sRUFBRSxDQUFBO0lBQ2QsQ0FBQztJQUVELE1BQU0sQ0FBRyxNQUFhLEVBQUUsTUFBTSxFQUFtQjtRQUU1QyxNQUFNLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxHQUFHLElBQUksQ0FBQTtRQUUzQixJQUFLLENBQUUsUUFBUSxDQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUU7WUFDeEIsR0FBRyxDQUFDLEtBQUssR0FBRyxNQUFNLEVBQUcsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFBO1FBRW5DLElBQUssQ0FBRSxRQUFRLENBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBRTtZQUN6QixHQUFHLENBQUMsTUFBTSxHQUFHLEdBQUcsQ0FFcEI7UUFBQyxJQUFJLENBQUMsUUFBMEIscUJBQVMsR0FBRyxDQUFFLENBQUE7UUFFL0MsSUFBSyxJQUFJLENBQUMsS0FBSyxJQUFJLFNBQVM7WUFDdkIsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUcsSUFBSSxDQUFDLEtBQUssQ0FBRSxDQUFBO1FBRXZDLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFHLElBQUksQ0FBQyxLQUFLLENBQUUsQ0FFOUI7UUFBQyxJQUFJLENBQUMsS0FBZSxHQUFHLE1BQU0sQ0FBQTtRQUUvQixJQUFJLENBQUMsY0FBYyxFQUFHLENBQUE7SUFDM0IsQ0FBQztJQUVELGNBQWM7UUFFVCxNQUFNLEVBQUUsUUFBUSxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsR0FBRyxJQUFJLENBQUE7UUFFckMsSUFBSyxLQUFLLElBQUksU0FBUztZQUNsQixPQUFNO1FBRVgsTUFBTSxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQTtRQUVyQyxNQUFNLEdBQUcsR0FBTSxHQUFHLENBQUMsS0FBSyxJQUFJLE1BQU0sRUFBRyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUE7UUFDOUMsTUFBTSxDQUFDLEdBQVEsR0FBRyxDQUFFLEdBQUcsQ0FBQyxDQUFBO1FBQ3hCLE1BQU0sQ0FBQyxHQUFRLEdBQUcsQ0FBRSxHQUFHLENBQUMsQ0FBQTtRQUN4QixNQUFNLENBQUMsR0FBUSxLQUFLLENBQUMsV0FBVyxFQUFHLEdBQUcsQ0FBQyxDQUFBO1FBQ3ZDLE1BQU0sTUFBTSxHQUFHLE9BQU8sR0FBRyxDQUFDLE1BQU0sSUFBSSxRQUFRO1lBQzdCLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFHLEdBQUcsR0FBRyxDQUFDLE1BQU07WUFDbEMsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUcsR0FBRyxHQUFHLENBQUE7UUFFMUMsSUFBSSxDQUFDLFdBQVcsQ0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFFLENBQUE7SUFDNUQsQ0FBQztDQUNMIn0=